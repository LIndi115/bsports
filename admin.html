<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GENTI TERM | Ultra Admin Multi-Upload</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        :root { --primary: #007aff; --bg: #030303; --card: #161617; --border: rgba(255,255,255,0.08); }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: white; padding: 20px; }
        .wrapper { max-width: 1000px; margin: 0 auto; display: none; }
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 999; display: flex; align-items: center; justify-content: center; }
        .glass { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 30px; margin-bottom: 20px; }
        input, textarea { width: 100%; padding: 15px; background: #000; border: 1px solid var(--border); border-radius: 12px; color: white; margin-bottom: 15px; }
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; }
        .punimi-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border); }
        .punimi-item img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; border: 1px solid var(--border); }
        .multi-preview { display: flex; gap: 5px; overflow-x: auto; margin-bottom: 15px; }
        .multi-preview img { height: 80px; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="glass" style="width: 350px; text-align: center;">
            <h2>Admin Access</h2><br>
            <input type="text" id="user-in" placeholder="Username">
            <input type="password" id="pass-in" placeholder="Password">
            <button class="btn" onclick="login()">HYR</button>
        </div>
    </div>

    <div class="wrapper" id="panel">
        <h1 style="margin-bottom: 30px;">GENTI<span style="color:#ff3b30">TERM</span> Dashboard</h1>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="glass">
                <h3>Shto Album të Ri</h3><br>
                <input type="text" id="titulli" placeholder="Titulli (Psh: Montimi Bergen 16kw)">
                <textarea id="pershkrimi" placeholder="Përshkrimi..."></textarea>
                <p style="font-size: 0.8rem; color: #86868b; margin-bottom: 5px;">Zgjidh 1 ose më shumë foto:</p>
                <input type="file" id="foto-input" multiple accept="image/*">
                <button class="btn" id="up-btn" onclick="uploadAlbum()">PUBLIKO ALBUMIN</button>
                <p id="st" style="margin-top: 10px; font-size: 0.8rem; text-align: center; color: var(--primary);"></p>
            </div>

            <div class="glass">
                <h3>Punimet Aktuale</h3><br>
                <div id="live-list"></div>
            </div>
        </div>
    </div>

    <script>
        function login() {
            if(document.getElementById('user-in').value === "admin" && document.getElementById('pass-in').value === "genti2026") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('panel').style.display = 'block';
            } else { alert("Gabim!"); }
        }

        const firebaseConfig = {
            apiKey: "AIzaSyBh_7BwfNbKbscPSW1ZN9Y_UvAntsj19Wg",
            authDomain: "herolind-6ca5f.firebaseapp.com",
            projectId: "herolind-6ca5f",
            storageBucket: "herolind-6ca5f.firebasestorage.app",
            messagingSenderId: "893085364638",
            appId: "1:893085364638:web:2db59e6ec72ad7e7c1a68f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const IMGBB_KEY = "eb62a6907856c805db10887e57fa34ea";

        async function uploadAlbum() {
            const files = document.getElementById('foto-input').files;
            const tit = document.getElementById('titulli').value;
            const per = document.getElementById('pershkrimi').value;
            const btn = document.getElementById('up-btn');
            const st = document.getElementById('st');

            if(files.length === 0 || !tit) return alert("Shto titullin dhe fotot!");

            btn.disabled = true;
            let uploadedUrls = [];

            for(let i=0; i < files.length; i++) {
                st.innerText = `Duke ngarkuar foton ${i+1} nga ${files.length}...`;
                const formData = new FormData();
                formData.append("image", files[i]);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: formData });
                const data = await res.json();
                if(data.success) uploadedUrls.push(data.data.url);
            }

            st.innerText = "Duke ruajtur albumin...";
            await db.collection("projekte").add({
                titulli: tit,
                pershkrimi: per,
                images: uploadedUrls, // TASH RUHEN SI LISTE (ARRAY)
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert("Albumi u publikua!");
            location.reload();
        }

        db.collection("projekte").orderBy("timestamp", "desc").onSnapshot(snap => {
            const list = document.getElementById('live-list');
            list.innerHTML = '';
            snap.forEach(doc => {
                const d = doc.data();
                const imgCount = d.images ? d.images.length : 1;
                list.innerHTML += `
                    <div class="punimi-item">
                        <img src="${d.images ? d.images[0] : d.imageUrl}">
                        <div style="flex-grow:1">
                            <b>${d.titulli}</b><br>
                            <small>${imgCount} foto</small>
                        </div>
                        <button onclick="fshi('${doc.id}')" style="background:none; border:none; color:#ff3b30; cursor:pointer;"><i class="fas fa-trash"></i></button>
                    </div>`;
            });
        });

        async function fshi(id) { if(confirm("Fshi?")) await db.collection("projekte").doc(id).delete(); }
    </script>
</body>
</html>
